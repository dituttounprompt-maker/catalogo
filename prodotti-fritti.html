<!DOCTYPE html>
<html lang="it"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Catalogo Prodotti ZANON SEAFISH ‚Äì Prodotti fritti (mail)</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#fbfbf8;--ink:#111;--muted:#606060;--line:#e7e4dc;--brand:#0b5;--price:#0a6a2b;--accent:var(--brand)}
*{box-sizing:border-box}html,body{height:100%}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink)}
header{background:linear-gradient(180deg,#0b1620 0%, #0e1f2a 60%, #0e1f2a00 100%);color:#fff;padding:20px 12px 18px;text-align:center;position:relative}
header .top{display:flex;flex-direction:column;align-items:center;gap:8px;max-width:1100px;margin:0 auto}
header img.logo{height:60px;width:auto;display:block;margin:0 auto}
header h1{font-family:"Playfair Display",serif;font-weight:600;letter-spacing:.02em;margin:0 0 2px 0;font-size:24px;line-height:1.15}
header .sub{opacity:.85;font-size:11.5px;margin-top:0}
.tools{display:flex;justify-content:center;margin-top:8px}
.search{max-width:480px;width:100%}
.search input{width:100%;padding:10px;border-radius:999px;border:1px solid #ffffff40;background:#ffffff12;color:var(--brand);outline:none}
.count{color:var(--brand);margin-top:8px;font-size:12px}
.container{max-width:1100px;margin:6px auto 14px;padding:0 10px}
.list{display:flex;flex-direction:column;gap:10px}
.item{display:grid;grid-template-columns:84px 1fr 100px;gap:14px;align-items:center;background:rgba(255,255,255,.92);border:1px solid var(--line);border-radius:10px;padding:8px 10px;box-shadow:0 1px 6px rgba(0,0,0,.06)}
.thumb{width:84px;height:84px;border-radius:12px;overflow:hidden;background:#f1f1ed;border:1px solid var(--line)}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.info{min-width:0;padding-left:8px}
.title{font-family:"Playfair Display",serif;font-weight:700;font-size:18px;letter-spacing:.02em;margin:0 0 3px 0;text-transform:uppercase}
.desc{color:var(--muted);font-size:12px;line-height:1.3;margin:0 0 4px 0}
.divider{height:1px;background:var(--line);margin:3px 0}
.price-wrap{justify-self:end;align-self:end;text-align:right}
.price{color:var(--price);font-weight:700;font-size:16px}
.iva-note{display:block;font-size:11px;line-height:1.05;color:#666;margin-top:2px;text-transform:uppercase;letter-spacing:.02em;text-align:center}
.qty{display:inline-flex;align-items:center;gap:6px;border:1px solid #ddd;border-radius:999px;padding:4px 6px;margin-top:6px;user-select:none}
.qty button{border:none;background:#f6f6f3;padding:4px 8px;border-radius:999px;font-size:14px;cursor:pointer}
.qty .num{min-width:20px;text-align:center;font-weight:700}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:1000}
.modal.open{display:flex}
.modal-content{background:#fff;border-radius:12px;max-width:860px;width:min(96vw,860px);padding:20px;position:relative;max-height:90vh;overflow:hidden;box-shadow:0 10px 24px rgba(0,0,0,.35);display:flex;flex-direction:column}
.m-title{font-family:"Playfair Display",serif;margin:0 0 10px 0}
#mGallery{flex:1 1 auto;overflow:auto;display:grid;gap:12px;align-items:center;justify-items:center}
.m-iva{font-size:12px;color:#666;margin:4px 0 0 0;text-transform:uppercase;letter-spacing:.02em}
.cart{position:fixed;left:14px;top:10px;background:rgba(255,255,255,.9);backdrop-filter:blur(2px);border:1px solid #ddd;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.15);padding:10px 12px;max-width:340px;z-index:1500;display:inline-flex;align-items:center}
.cart.collapsed{display:inline-flex;align-items:center;gap:6px;white-space:nowrap;border-radius:999px;padding:6px 10px;cursor:pointer}
.cart h4{margin:0 0 6px 0;font-size:14px}
.cart-list{font-size:12px;line-height:1.35;max-height:160px;overflow:auto;margin-bottom:6px}
.cart-empty{color:#777;font-style:italic}
.cart-total{display:flex;justify-content:space-between;align-items:center;font-weight:700;margin-top:6px}
.cart-actions{display:flex;justify-content:space-between;align-items:center;margin-top:6px;gap:8px}
.cart button{border:none;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer;background:var(--accent);color:#fff}
.cart .toggle{background:#eee;color:#222}
.cart.collapsed .when-expanded{display:none}
.cart:not(.collapsed) .when-expanded{display:block}
.cart.collapsed .when-collapsed{display:inline-flex;gap:6px;align-items:center}
.actions-bottom{display:flex;justify-content:center;gap:10px;margin:16px 0 6px}
.actions-bottom button{border:none;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer;background:var(--accent);color:#fff;box-shadow:0 4px 10px rgba(0,0,0,.12)}
.actions-bottom .ghost{background:#eee;color:#222}
.site-footer{max-width:1100px;margin:18px auto 24px;padding:0 10px;color:#444;font-size:12px}
.site-rule{border:none;height:1px;background:#e5e2da;margin:6px 0 10px}
.site-footer-inner{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.footer-logo{height:20px;width:auto}
.foot-text{flex:1;min-width:240px}
.foot-mail{font-size:12px;color:#0b5;text-decoration:none}
.print-footer{display:none!important}
@media print{ @page{size:A4;margin:14mm 12mm} body{background:#fff} header{background:none!important;color:#000!important;border-bottom:1px solid #ddd!important;padding:0 0 6mm} .sub{display:none!important} .tools,#count,.cart,.qty,.share-small,.actions-bottom{display:none!important} .item{break-inside:avoid-page;page-break-inside:avoid;box-shadow:none;border-color:#ddd;background:#fff} .modal{display:none!important} .site-rule{background:#000;height:1px} .site-footer{color:#000} .foot-mail{color:#000;text-decoration:underline} .print-footer{display:block!important;position:fixed;bottom:0;left:0;right:0;width:100%;text-align:center;font-size:10px;color:#000;opacity:.95} .print-footer .line{display:inline-flex;align-items:center;gap:6px} .print-footer img{height:12px;width:auto;vertical-align:middle} .print-footer .text{font-weight:600} }
@media (max-width:820px){header{padding:16px 10px 16px} header h1{font-size:22px} .item{grid-template-columns:76px 1fr 96px} .thumb{width:76px;height:76px;border-radius:10px} .title{font-size:16px} .price{font-size:15px}}
@media (max-width:560px){header{padding:14px 8px 14px} header h1{font-size:20px} .item{grid-template-columns:66px 1fr;grid-template-rows:auto auto;gap:8px} .price-wrap{grid-column:2;justify-self:end}}
</style></head>
<body>
<header><div class="top">
  <img class="logo" src="images/logo.png" alt="Zanon Seafish Ingros SRL" onerror="this.onerror=null;this.src='images/default1.jpg';">
  <h1>Catalogo Prodotti ZANON SEAFISH ‚Äì Prodotti fritti</h1>
  <div class="sub">Clicca un elemento per i dettagli e la condivisione.</div>
  <div class="tools"><div class="search"><input id="searchBox" placeholder="Cerca prodotti‚Ä¶"></div></div>
  <div id="count" class="count"></div>
</div></header>

<div class="print-footer" aria-hidden="true">
  <span class="line"><img src="images/logo.png" alt="Zanon Seafish"><span class="text">Zanon Seafish ‚Äì Catalogo Prodotti</span></span>
</div>

<div class="container"><div id="list" class="list"></div></div>

<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-content" aria-labelledby="mTitle">
    <h2 id="mTitle" class="m-title"></h2>
    <div id="mGallery"></div>
    <p id="mDesc" class="desc"></p>
    <p id="mFullDesc"></p>
    <p id="mPrice" class="price" style="margin-top:0"></p>
    <p class="m-iva">IVA ESCLUSA</p>
    <div class="qty" aria-label="Quantit√†" style="display:none">
      <button id="mMinus" aria-label="Diminuisci">‚Äì</button>
      <span id="mNum" class="num">0</span>
      <button id="mPlus" aria-label="Aumenta">+</button>
      <span class="mini">Quantit√†</span>
    </div>
    <div class="modal-footer">
      <button id="shareBtn" class="share-small" title="Condividi" aria-label="Condividi">üì§ Condividi</button>
      <button id="closeBtn" class="close-btn" aria-label="Chiudi">Chiudi</button>
    </div>
  </div>
</div>

<div id="cart" class="cart collapsed" aria-live="polite">
  <span class="when-collapsed">üßæ <strong id="miniCount">0</strong></span>
  <div class="when-expanded">
    <h4>Riepilogo</h4>
    <div id="cartList" class="cart-list cart-empty">Nessun articolo</div>
    <div class="cart-total"><span>Totale</span><span id="cartTotal">‚Ç¨ 0,00</span></div>
    <div class="cart-actions">
      <button id="toggleBtn" class="toggle" type="button">Riduci</button>
      <button id="mailBtn" type="button">Prepara mail</button>
    </div>
  </div>
</div>

<div class="actions-bottom" id="final-actions">
  <button id="backBtn" class="ghost" type="button">‚Üê Indietro</button>
  <button id="openCartBtn" class="ghost" type="button">Vedi carrello</button>
  <button id="mailBtnBottom" type="button">Prepara mail</button>
</div>

<footer class="site-footer">
  <hr class="site-rule">
  <div class="site-footer-inner">
    <img src="images/logo.png" alt="Zanon Seafish Ingros SRL" class="footer-logo" onerror="this.style.display='none'">
    <div class="foot-text">
      <strong>Zanon Seafish Ingros SRL</strong> ¬∑ P.IVA IT01654690278 ¬∑
      Sede legale: S. Croce 491, 30135 Venezia (VE) ¬∑
      Sede amm. e magazzini: Via Colombara 115/A, 30176 Marghera (VE) ¬∑
      Tel: 041 5382830 ¬∑ 041 3963095 ¬∑
      <a href="https://www.zanonseafish.it/" target="_blank" rel="noopener">www.zanonseafish.it</a> ¬∑
      <a href="mailto:info@zanonseafish.it">info@zanonseafish.it</a>
    </div>
    <a class="foot-mail" href="mailto:info@zanonseafish.it" title="Scrivi a info@zanonseafish.it">‚úâÔ∏è Contattaci</a>
  </div>
  </br>
</footer>
</br>

<script>
/* CART SHARED v2 */
var CART_KEY='zanonCartV1';
var PROD_REG=new Map();
function regProducts(list){
  var basePath=location.origin+location.pathname.replace(/[^/]*$/,'');
  for(var i=0;i<list.length;i++){
    var p=list[i];
    PROD_REG.set(p.id,{id:p.id,name:p.name,price:p.price||0,unit:p.unit||'',shortDesc:p.shortDesc||'',images:(p.images||[]),basePath:basePath});
  }
}
function loadCart(){try{return JSON.parse(localStorage.getItem(CART_KEY))||{}}catch(e){return {}}}
function saveCart(c){localStorage.setItem(CART_KEY,JSON.stringify(c))}
function unitLabel(u){return u==='/kg'?' ‚Ç¨/kg':(u==='/confezione'?' ‚Ç¨/conf.':'')}
var Cart={data:loadCart(),get:function(id){return this.data[id]|0},set:function(id,q){q=Math.max(0,q|0); if(q===0) delete this.data[id]; else this.data[id]=q; saveCart(this.data); window.dispatchEvent(new Event('cart:update'));},clear:function(){this.data={}; saveCart(this.data); window.dispatchEvent(new Event('cart:update'))},items:function(){var out=[]; for(var k in this.data){out.push({id:k,qty:this.data[k],meta:PROD_REG.get(k)})} return out;}};
window.addEventListener('storage',function(e){if(e.key===CART_KEY){Cart.data=loadCart(); window.dispatchEvent(new Event('cart:update'));}});

/* DATA */
const PRODUCTS = [

{id:"polpette-brasato",name:"Polpette di Brasato",price:14.00,shortDesc:"Conf. 2kg ‚Äì Polpette di brasato surgelate (40 pz da 50g)",fullDesc:"Polpette di brasato dal gusto autentico, preparate con carne di manzo selezionata. Ideali per secondi o buffet caldi.",images:["img2/polpette-brasato.jpg"]},
  {id:"polpette-baccala",name:"Polpette di Baccal√†",price:14.00,shortDesc:"Conf. 2kg ‚Äì Polpette di baccal√† surgelate (40 pz da 50g)",fullDesc:"Polpette morbide a base di baccal√† e patate. Perfette fritte o al forno come antipasto di mare.",images:["img2/polpette-baccala.jpg"]},
  {id:"polpette-tonno-cipolla",name:"Polpette di Tonno e Cipolla",price:14.00,shortDesc:"Conf. 2kg ‚Äì Polpette di tonno e cipolla (40 pz da 50g)",fullDesc:"Polpette di tonno con cipolla dolce e spezie mediterranee. Croccanti e profumate.",images:["img2/polpette-tonno-cipolla.jpg"]},
  {id:"polpette-pollo-speck",name:"Polpette di Pollo e Speck",price:12.00,shortDesc:"Conf. 2kg ‚Äì Polpette di pollo e speck (40 pz da 50g)",fullDesc:"Polpette dal sapore deciso con carne di pollo e speck affumicato. Ottime per aperitivi o secondi piatti.",images:["img2/polpette-pollo-speck.jpg"]},
  {id:"polpette-verdure",name:"Polpette di Verdure",price:12.00,shortDesc:"Conf. 2kg ‚Äì Polpette di verdure miste (40 pz da 50g)",fullDesc:"Polpette vegetariane con verdure fresche selezionate. Leggere e gustose, ideali per contorni o buffet.",images:["img2/polpette-verdure.png"]},
  {id:"arancini-mozzarella-prosciutto",name:"Arancini con Mozzarella e Prosciutto Prefritti",price:5.50,shortDesc:"Conf. 3kg ‚Äì Arancini con mozzarella e prosciutto prefritti",fullDesc:"Arancini di riso con cuore di mozzarella e prosciutto cotto. Pronti per la cottura.",images:["img2/arancini-prosciutto.png"]},
  {id:"arancini-spinaci",name:"Arancini agli Spinaci Prefritti",price:5.50,shortDesc:"Conf. 3kg ‚Äì Arancini agli spinaci prefritti",fullDesc:"Arancini di riso con ripieno cremoso agli spinaci e formaggio. Croccanti e saporiti.",images:["img2/arancini-spinaci.png"]},
  {id:"arrosticini-mare",name:"Arrosticini di Mare Panati (Totano Gigas)",price:8.30,shortDesc:"Conf. 4kg ‚Äì Arrosticini di mare panati",fullDesc:"Spiedini di totano gigas impanati e croccanti. Ideali fritti o al forno.",images:["img2/arrosticini-pesce-panati.png"]},
  {id:"alici-panato",name:"Alici Panate Croccanti",price:8.90,shortDesc:"Conf. 1kg ‚Äì Alici panate croccanti",fullDesc:"Filetti di alici panati e dorati. Ottimi per antipasti o secondi di mare.",images:["img2/alici-panati-croccanti.png"]},
  {id:"filetto-baccala-prezzemolo",name:"Filetto di Baccal√† Pastellato con Prezzemolo",price:11.90,shortDesc:"Conf. 5x1kg ‚Äì Filetti di baccal√† pastellati con prezzemolo",fullDesc:"Filetti di baccal√† teneri in pastella aromatica al prezzemolo. Croccanti e profumati.",images:["img2/filetti-baccala-pastellati.png"]},
  {id:"chele-granchio",name:"Chele di Granchio Panate",price:5.50,shortDesc:"Conf. 4x1kg ‚Äì Chele di granchio panate",fullDesc:"Chele di surimi al gusto di granchio, con panatura dorata e croccante. Pronte in pochi minuti.",images:["img2/chele-granchio-panate.jpg"]},
  {id:"fiori-zucca-mozzarella-alici",name:"Fiori di Zucca con Mozzarella e Alici Prefritti",price:9.30,shortDesc:"Conf. 5x1kg ‚Äì Fiori di zucca con mozzarella e alici",fullDesc:"Fiori di zucca ripieni di mozzarella e alici. Croccanti e saporiti, gi√† pronti da rigenerare.",images:["img2/fiori-zucca-mozz-alici.png"]},
  {id:"fiori-zucca-prosciutto-mozzarella",name:"Fiori di Zucca con Prosciutto e Mozzarella Prefritti",price:8.10,shortDesc:"Conf. 5x1kg ‚Äì Fiori di zucca con prosciutto e mozzarella",fullDesc:"Fiori di zucca con farcitura di prosciutto cotto e mozzarella filante. Doratura perfetta.",images:["img2/fiori-zucca-mozz-prosciutto.png"]},
  {id:"frittelle-gamberi-zucchine",name:"Frittelle di Gamberi e Zucchine",price:11.50,shortDesc:"Conf. 4x1kg ‚Äì Frittelle di gamberi e zucchine",fullDesc:"Frittelle di gamberi e zucchine in pastella croccante. Pronte in pochi minuti.",images:["img2/frittelle-gamberi-zucchine.png"]},
  {id:"gamberi-patata",name:"Gamberi Avvolti in Filo di Patata",price:14.00,shortDesc:"Conf. 5x1kg ‚Äì Gamberi avvolti in filo di patata",fullDesc:"Gamberi croccanti rivestiti di julienne di patata. Specialit√† gourmet.",images:["img2/gamberi-patata.jpg"]},
  {id:"mozzarelline-tartufo",name:"Mozzarelline Panate con Tartufo Prefritte",price:7.80,shortDesc:"Conf. 5x1kg ‚Äì Mozzarelline con tartufo prefritte",fullDesc:"Mozzarelline filanti aromatizzate al tartufo. Perfette per aperitivi.",images:["img2/mozzarelline-tartufo.png"]},
  {id:"olive-ascolane",name:"Olive Ascolane",price:5.40,shortDesc:"Conf. 4x2,500kg ‚Äì Olive ascolane ripiene di carne",fullDesc:"Olive verdi farcite con carne e panate. Croccanti e dorate in pochi minuti.",images:["img2/olive-ripiene-ascolana.png"]},
  {id:"olive-ascolane-prefritte",name:"Olive Ascolane Prefritte",price:5.90,shortDesc:"Conf. 5x1kg ‚Äì Olive ascolane prefritte",fullDesc:"Versione prefritta delle classiche olive ascolane, pronte da rigenerare in forno o friggitrice.",images:["img2/olive-ripiene-ascolana.png"]},
  {id:"panzerotti-mozzarella",name:"Panzerotti Mozzarella e Pomodoro Prefritti",price:5.40,shortDesc:"Conf. 5x1kg ‚Äì Panzerotti con mozzarella e pomodoro",fullDesc:"Mini panzerotti con ripieno di pomodoro e mozzarella filante. Perfetti come finger food.",images:["img2/panzerotti-mozzarella.png"]},
  {id:"polpette-melanzane",name:"Polpette di Melanzane, Mozzarella e Provola Affumicata",price:5.50,shortDesc:"Conf. 5x1kg ‚Äì Polpette di melanzane con mozzarella e provola affumicata",fullDesc:"Polpette vegetariane dal sapore intenso e consistenza morbida. Perfette per aperitivi e buffet.",images:["img2/polpette-melanzane.png"]},
  {id:"salvia-pastellata",name:"Salvia Pastellata Prefritta",price:11.50,shortDesc:"Conf. 4x1kg ‚Äì Foglie di salvia pastellate prefritte",fullDesc:"Foglie di salvia immerse in pastella leggera e croccante. Profumate e aromatiche.",images:["img2/salvia-pastellata.png"]},
  {id:"tris-verdure",name:"Tris di Verdure Pastellate Prefritte",price:5.20,shortDesc:"Conf. 5x1kg ‚Äì Tris di verdure pastellate prefritte",fullDesc:"Mix croccante di zucchine, carote e peperoni in pastella dorata. Perfette per contorni o antipasti.",images:["img2/tris-verdure.png"]}

];
PRODUCTS.sort(function(a,b){ return String(a.id).localeCompare(String(b.id)); });
regProducts(PRODUCTS);

/* Helpers */
var fmt = new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"});
function getQty(id){return Cart.get(id)}
function setQty(id,q){Cart.set(id,q); renderCart(); syncRowQty(id); if(typeof updateModalQty==='function') updateModalQty();}
function addQty(id,delta){setQty(id, getQty(id)+delta)}
function abbr(p){ return p.abbr || p.name; }

/* Render list */
var listEl=document.getElementById("list");
function rowTemplate(p){
  return '<div id="'+p.id+'" class="item" data-id="'+p.id+'">'
    + '<div class="thumb" onclick="openModal(\''+p.id+'\')">'
    +   '<img loading="lazy" src="'+((p.images&&p.images[0])||'images/default1.jpg')+'" alt="'+p.name+'" onerror="this.onerror=null;this.src=\'images/default1.jpg\';">'
    + '</div>'
    + '<div class="info">'
    +   '<h3 class="title"><button class="open" onclick="openModal(\''+p.id+'\')" style="all:unset;cursor:pointer;color:inherit">'+p.name+'</button></h3>'
    +   '<p class="desc">'+(p.shortDesc||"")+'</p>'
    +   '<div class="divider"></div>'
    +   '<div class="qty" aria-label="Quantit√†" onclick="event.stopPropagation();">'
    +     '<button onclick="event.stopPropagation();addQty(\''+p.id+'\',-1)" aria-label="Diminuisci">‚Äì</button>'
    +     '<span id="num-'+p.id+'" class="num">0</span>'
    +     '<button onclick="event.stopPropagation();addQty(\''+p.id+'\',+1)" aria-label="Aumenta">+</button>'
    +     '<span class="mini">Quantit√†</span>'
    +   '</div>'
    + '</div>'
    + '<div class="price-wrap">'
    +   '<div class="price">'+fmt.format(p.price||0)+(p.unit?unitLabel(p.unit):'')+'</div>'
    +   '<span class="iva-note">IVA ESCLUSA</span>'
    + '</div>'
    + '</div>';
}
function render(list){
  var target = list || PRODUCTS;
  var html = '';
  for(var i=0;i<target.length;i++){ html += rowTemplate(target[i]); }
  listEl.innerHTML = html ? html : '<div class="item">Nessun risultato</div>';
  countEl.textContent = (target.length===PRODUCTS.length? (target.length+' prodotti') : (target.length+' risultati'));
  syncAllQty();
}

/* Search */
var q=document.getElementById("searchBox");
var countEl=document.getElementById("count");
q.addEventListener("input",function(){
  var v=(q.value||"").replace(/^\s+|\s+$/g,'').toLowerCase();
  if(!v){ render(PRODUCTS); return; }
  var res=[];
  for(var i=0;i<PRODUCTS.length;i++){
    var p=PRODUCTS[i];
    var hay=(String(p.name)+' '+(p.shortDesc||'')+' '+(p.fullDesc||'')).toLowerCase();
    if(hay.indexOf(v)!==-1) res.push(p);
  }
  render(res);
});

/* Modal */
var modal=document.getElementById("modal");
var mTitle=document.getElementById("mTitle");
var mDesc=document.getElementById("mDesc");
var mFullDesc=document.getElementById("mFullDesc");
var mPrice=document.getElementById("mPrice");
var mGallery=document.getElementById("mGallery");
var shareBtn=document.getElementById("shareBtn");
var closeBtn=document.getElementById("closeBtn");
var mMinus=document.getElementById("mMinus");
var mPlus=document.getElementById("mPlus");
var mNum=document.getElementById("mNum");
var currentId=null;

function adjustModalLayout(){}
function resetModalScroll(){ mGallery.scrollTop=0; }
window.openModal = function(id){
  var p=null;
  for(var i=0;i<PRODUCTS.length;i++){ if(PRODUCTS[i].id===id){ p=PRODUCTS[i]; break; } }
  if(!p) return;
  currentId=id;
  mTitle.textContent=p.name||"";
  mDesc.textContent=p.shortDesc||"";
  mFullDesc.textContent=p.fullDesc||"";
  mPrice.textContent=fmt.format(p.price||0)+(p.unit?unitLabel(p.unit):"");
  var imgs=(p.images||[]).slice(0,2);
  var g='';
  for(var k=0;k<imgs.length;k++){ var src=imgs[k]||'images/default1.jpg'; g+= '<img loading="lazy" src="'+src+'" alt="'+p.name+'" onerror="this.onerror=null;this.src=\'images/default1.jpg\';">'; }
  mGallery.innerHTML=g;
  document.querySelector('#modal .qty').style.display='inline-flex';
  updateModalQty();
  modal.classList.add("open"); document.body.style.overflow='hidden'; resetModalScroll();
};
function updateModalQty(){ if(!currentId) return; mNum.textContent=getQty(currentId); }
function closeModal(){ modal.classList.remove("open"); document.body.style.overflow=''; }
closeBtn.addEventListener("click", closeModal);
modal.addEventListener("click", function(e){ if(e.target===modal) closeModal(); });
window.addEventListener("keydown",function(e){ if(e.key==="Escape") closeModal(); });
mMinus.addEventListener("click",function(){addQty(currentId,-1)});
mPlus.addEventListener("click",function(){addQty(currentId,+1)});
shareBtn.addEventListener("click", shareCurrent);

/* Sync qty */
function syncRowQty(id){ var el=document.getElementById('num-'+id); if(el) el.textContent=getQty(id); }
function syncAllQty(){ for(var i=0;i<PRODUCTS.length;i++) syncRowQty(PRODUCTS[i].id); }

/* Cart render */
var cartEl=document.getElementById('cart');
var cartListEl=document.getElementById('cartList');
var cartTotalEl=document.getElementById('cartTotal');
var miniCountEl=document.getElementById('miniCount');
var toggleBtn=document.getElementById('toggleBtn');
function positionCart(){
  var header=document.querySelector('header');
  var h = header ? header.offsetHeight : 0;
  cartEl.style.top = (h + 10) + 'px';
}
function renderCart(){
  var rows=[]; var total=0; var count=0;
  for(var id in Cart.data){
    var q=Cart.data[id]; if(q<=0) continue;
    var p=PROD_REG.get(id);
    if(!p){ // fallback search
      for(var i=0;i<PRODUCTS.length;i++) if(PRODUCTS[i].id===id){ p=PRODUCTS[i]; break; }
    }
    if(!p) continue;
    rows.push('‚Ä¢ '+(p.name||id)+' √ó '+q);
    total+=(p.price||0)*q; count+=q;
  }
  cartListEl.innerHTML = rows.length?rows.join('<br>'):'Nessun articolo';
  if(rows.length===0){ cartListEl.classList.add('cart-empty'); } else { cartListEl.classList.remove('cart-empty'); }
  cartTotalEl.textContent=fmt.format(total);
  miniCountEl.textContent=count;
  positionCart();
}
cartEl.addEventListener('click',function(){ if(cartEl.classList.contains('collapsed')){ cartEl.classList.remove('collapsed'); positionCart(); } });
toggleBtn.addEventListener('click',function(e){ e.stopPropagation(); cartEl.classList.add('collapsed'); positionCart(); });

/* Share */
function productUrl(id){ var base = location.origin + location.pathname; return base+'#'+id; }
async function shareCurrent(){
  var p = PROD_REG.get(currentId);
  if(!p){ for(var i=0;i<PRODUCTS.length;i++) if(PRODUCTS[i].id===currentId){ p=PRODUCTS[i]; break; } }
  if(!p){ alert('Apri un prodotto da condividere.'); return; }
  var url = productUrl(p.id);
  try{ await navigator.clipboard.writeText(url); alert('Link copiato.'); }catch(e){}
}

/* Mail */
function clearCart(){ Cart.clear(); renderCart(); syncAllQty(); }
function confirmAndClear(){ clearCart(); alert('Ordine pronto in email. Carrello azzerato.'); }
function openMail(){
  var items = Cart.items().filter(function(x){return x.qty>0});
  if(!items.length){ alert('Seleziona almeno un articolo.'); return; }
  var body='Gentile Zanon Seafish,%0D%0A%0D%0ADesidero inviare il seguente ordine:%0D%0A';
  body+='Q.t√† | Titolo | Short descr | Prezzo unitario | Totale riga%0D%0A';
  body+='--------------------------------------------------------------%0D%0A';
  var tot=0, count=0;
  for(var i=0;i<items.length;i++){
    var it=items[i]; var p=it.meta||{}; var q=it.qty; var sub=(p.price||0)*q; tot+=sub; count+=q;
    var line = q+' | '+(p.name||it.id)+' | '+(p.shortDesc||'')+' | '+fmt.format(p.price||0)+(p.unit?unitLabel(p.unit):'')+' | '+fmt.format(sub);
    body+=encodeURIComponent(line)+'%0D%0A';
  }
  body+='--------------------------------------------------------------%0D%0A';
  body+='Totale articoli: '+count+'%0D%0A';
  body+='Totale ordine: '+fmt.format(tot)+'%0D%0A%0D%0A';
  body+='Dati per il ritiro/consegna:%0D%0ANome azienda / nominativo:%0D%0AIndirizzo:%0D%0ATelefono:%0D%0AData desiderata:%0D%0A%0D%0AGrazie.%0D%0A';
  var subject=encodeURIComponent('Ordine Catalogo Prodotti');
  var mailto='mailto:info@zanonseafish.it?subject='+subject+'&body='+body;
  window.location.href = mailto;
  setTimeout(confirmAndClear, 400);
}
document.getElementById('mailBtn').addEventListener('click', openMail);
document.getElementById('mailBtnBottom').addEventListener('click', openMail);
document.getElementById('openCartBtn').addEventListener('click', function(){ document.getElementById('cart').classList.remove('collapsed'); positionCart(); });
document.getElementById('backBtn').addEventListener('click', function(){ if (history.length > 1) history.back(); else location.href = '/catalogo/'; });
window.addEventListener('cart:update', function(){ renderCart(); syncAllQty(); });

/* Init */
var countEl=document.getElementById("count");
function initialRender(){ render(PRODUCTS); positionCart(); }
initialRender();
</script>
</body></html>